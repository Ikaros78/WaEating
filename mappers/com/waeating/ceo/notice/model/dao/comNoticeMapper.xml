<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.waeating.ceo.notice.model.dao.ComNoticeMapper">
  	<resultMap type="com.waeating.ceo.notice.model.dto.ComNoticeDTO" id="comNoticeResultMap">
  		<id property="noticeNo" column="NOTICE_NO"/>
  		<result property="noticeTitle" column="NOTICE_TITLE"/>
  		<result property="noticeContent" column="NOTICE_CONTENT"/>
  		<result property="regDate" column="REG_DATE"/>
  		<result property="comNo" column="COM_NO"/>
  		<association property="comNoticeAttach" resultMap="comNoticeAttachResultMap"/>
  	</resultMap>
  	
  	<resultMap type="com.waeating.ceo.notice.model.dto.ComNoticeAttachDTO" id="comNoticeAttachResultMap">
  		<id property="fileNo" column="FILE_NO"/>
  		<result property="noticeNo" column="NOTICE_NO"/>
  		<result property="originName" column="ORIGIN_NAME"/>
  		<result property="fileName" column="FILE_NAME"/>
  		<result property="isDeleted" column="IS_DELETED"/>
  		<result property="date" column="DATE"/>
  	</resultMap>
  	
  	<insert id="insertComNotice" parameterType="com.waeating.ceo.notice.model.dto.ComNoticeDTO">
  		INSERT
  		  INTO COM_NOTICE CN
  		(
  			CN.NOTICE_NO, CN.NOTICE_TITLE, CN.NOTICE_CONTENT,
  			CN.REG_DATE, CN.COM_NO
  		)
  		VALUES
  		(
  			SEQ_NOTICENO.NEXTVAL, #{ noticeTitle }, #{ noticeContent },
  			SYSDATE, 1
  		)
  		<!-- CN.CON_NO : 업체 정보 받고 쿼리문 다시 수정하기 -->
  	</insert>
  	
  	<select id="selectAllNotice" resultMap="comNoticeResultMap">
  		 SELECT
  			    CN.NOTICE_TITLE
  			  , CN.REG_DATE
  	 	   FROM COM_NOTICE CN
  	 	  ORDER BY 2 DESC
  	</select>
  	
  	<select id="selectTotalCount" resultType="_int" parameterType="hashmap">
        SELECT
               COUNT(*)
          FROM COM_NOTICE CN
    	<if test="searchCondition == 'category'">
	      JOIN TBL_CATEGORY B ON(A.CATEGORY_CODE = B.CATEGORY_CODE)
    	</if>
    	<if test="searchCondition == 'writer'">
	      JOIN TBL_MEMBER B ON(A.BOARD_WRITER_MEMBER_NO = B.MEMBER_NO)
    	</if>
    	<where>
			<if test="searchCondition == 'category'">
	           B.CATEGORY_NAME = #{ searchValue }
			</if>
			<if test="searchCondition == 'writer'">
	           B.NICKNAME LIKE '%' || #{ searchValue } || '%'	
			</if>
			<if test="searchCondition == 'title'">
	           A.BOARD_TITLE LIKE '%' || #{ searchValue } || '%' 	
			</if>
			<if test="searchCondition == 'content'">
	           A.BOARD_BODY LIKE '%' || #{ searchValue } || '%' 	
			</if>
	       AND A.BOARD_STATUS = 'Y'
    	</where>
	</select>
  	
  	
  </mapper>